@inherits StepperComponentBase<AuctionViewModel>

@page "/create"

@using AuctionPortal.Components.ImageUpload
@using AuctionPortal.Components.ImageViewer
@using AuctionPortal.ViewModels

<MudText Typo="Typo.h4" GutterBottom="true">Create a New Auction</MudText>
<MudText Typo="Typo.subtitle2" Class="mb-4">
    Follow the steps below to create your auction.
</MudText>

<MudDivider Class="my-4" />

<MudStepper @ref="stepper"
            CompletedStepColor="Color.Success"
            OnPreviewInteraction="Validator.OnPreviewInteraction">

    <!-- STEP 1 -->
    <MudStep Title="Step 1: Auction Details"
             SecondaryText="Enter a name and description"
             HasError="Validator.HasError(0)">
        <MudStack Spacing="3">
            <MudTextField @bind-Value="ViewModel.Name"
                          Label="Name"
                          Variant="Variant.Outlined"
                          FullWidth="true"
                          Error="Validator.HasError(0)"
                          HelperText="@(!Validator.HasError(0) ? "Enter a descriptive name for your auction." : null)"
                          ErrorText="@(Validator.HasError(0) ? "Name is required." : null)" />

            <MudTextField @bind-Value="ViewModel.Description"
                          Label="Description"
                          Lines="4"
                          Variant="Variant.Outlined"
                          FullWidth="true"
                          HelperText="Optional: Add more detail about the auction." />
        </MudStack>
    </MudStep>

    <!-- STEP 2 -->
    <MudStep Title="Step 2: Upload Image"
             SecondaryText="Add a single image"
             HasError="Validator.HasError(1)">
        <MudStack Spacing="3">
            <SingleImageUploader TImage="ImageViewModel" @bind-Image="ViewModel.Image" />

            @if (Validator.HasError(1))
            {
                @foreach (var msg in Validator.GetErrorMessages(1))
                {
                    <MudText Color="Color.Error" Typo="Typo.caption">@msg</MudText>
                }
            }
            else
            {
                <MudText Typo="Typo.caption">Upload an image for your auction.</MudText>
            }
        </MudStack>
    </MudStep>

    <!-- STEP 3 -->
    <MudStep Title="Step 3: Schedule"
             SecondaryText="Choose start and end times"
             HasError="Validator.HasError(2)">
        <MudStack Spacing="3">
            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudDatePicker Label="Start Date"
                                   DateFormat="dd/MM/yyyy"
                                   Date="@ViewModel.StartDate"
                                   DateChanged="@(d => ViewModel.StartDate = d.Value)"
                                   Variant="Variant.Outlined" />
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudTimePicker Label="Start Time"
                                   Time="@ViewModel.StartTime"
                                   TimeChanged="@(d => ViewModel.StartTime = d.Value)"
                                   Variant="Variant.Outlined" />
                </MudItem>
            </MudGrid>

            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudDatePicker Label="End Date"
                                   DateFormat="dd/MM/yyyy"
                                   Date="@ViewModel.EndDate"
                                   DateChanged="@(d => ViewModel.EndDate = d.Value)"
                                   Variant="Variant.Outlined" />
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudTimePicker Label="End Time"
                                   Time="@ViewModel.EndTime"
                                   TimeChanged="@(d => ViewModel.EndTime = d.Value)"
                                   Variant="Variant.Outlined" />
                </MudItem>
            </MudGrid>

            @if (Validator.HasError(2))
            {
                @foreach (var message in Validator.GetErrorMessages(2))
                {
                    <MudText Color="Color.Error" Typo="Typo.caption">@message</MudText>
                }
            }
            else
            {
                <MudText Typo="Typo.caption">
                    Select valid start and end dates for your auction.
                </MudText>
            }
        </MudStack>
    </MudStep>

    <!-- STEP 4 -->
    <MudStep Title="Step 4: Confirmation"
             SecondaryText="Confirm all details are correct"
             CompletedChanged="OnCompletedChanged">

        <MudStack Spacing="3">
            <MudText Typo="Typo.subtitle1">Confirm all things are correct</MudText>
            <MudText Typo="Typo.caption" Class="text-secondary">
                Review your details before submission.
            </MudText>

            <MudDivider Class="my-2" />
        </MudStack>
    </MudStep>
</MudStepper>
