@inherits StepperComponentBase<AuctionViewModel>

@page "/auctions/create"
@page "/auctions/{AuctionId:guid}/edit"

@using AuctionPortal.Components.ImageUpload
@using AuctionPortal.Components.ImageViewer
@using AuctionPortal.Components.Shared
@using AuctionPortal.ViewModels

<MudText Typo="Typo.h4" GutterBottom="true">
    @(IsEditMode ? $"Edit Auction: {ViewModel?.Name ?? ""}" : "Create a New Auction")
</MudText>

<MudText Typo="Typo.subtitle2" Class="mb-4">
    @(IsEditMode
        ? "Make changes and update your auction details below."
        : "Follow the steps below to create your auction.")
</MudText>

<MudDivider Class="my-4" />

<LoadingContainer TData="AuctionViewModel" IsLoading="IsLoading" Data="ViewModel">
    <MudStepper @ref="stepper"
                CompletedStepColor="Color.Success"
                OnPreviewInteraction="Validator.OnPreviewInteraction">

        <!-- STEP 1: Auction Details -->
        <MudStep Title="Step 1: Auction Details" Skippable="IsEditMode"
                 SecondaryText="Enter a name and description"
                 HasError="Validator.HasError(0)">
            <MudStack Spacing="3">
                <MudTextField @bind-Value="ViewModel.Name"
                              Label="Name"
                              Variant="Variant.Outlined"
                              FullWidth="true"
                              Error="Validator.HasError(0)"
                              HelperText="@(!Validator.HasError(0) ? "Enter a descriptive name for your auction." : null)"
                              ErrorText="@(Validator.HasError(0) ? "Name is required." : null)" />

                <MudTextField @bind-Value="ViewModel.Description"
                              Label="Description"
                              Lines="4"
                              Variant="Variant.Outlined"
                              FullWidth="true"
                              HelperText="Optional: Add more detail about the auction." />
            </MudStack>
        </MudStep>

        <!-- STEP 2: Upload Image -->
        <MudStep Title="Step 2: Upload Image" Skippable="IsEditMode"
                 SecondaryText="Add or change your auction image"
                 HasError="Validator.HasError(1)">
            <MudStack Spacing="3">
                <SingleImageUploader TImage="ImageViewModel" @bind-Image="ViewModel.Image" />

                @if (Validator.HasError(1))
                {
                    @foreach (var msg in Validator.GetErrorMessages(1))
                    {
                        <MudText Color="Color.Error" Typo="Typo.caption">@msg</MudText>
                    }
                }
                else
                {
                    <MudText Typo="Typo.caption">
                        @(IsEditMode ? "Update your auction image if needed." : "Upload an image for your auction.")
                    </MudText>
                }
            </MudStack>
        </MudStep>

        <!-- STEP 3: Schedule -->
        <MudStep Title="Step 3: Schedule" Skippable="IsEditMode"
                 SecondaryText="Choose start and end times"
                 HasError="Validator.HasError(2)">
            <MudStack Spacing="3">
                <MudGrid>
                    <MudItem xs="12" sm="6">
                        <MudDatePicker Label="Start Date"
                                       DateFormat="dd/MM/yyyy"
                                       Date="@ViewModel.StartDate"
                                       DateChanged="@(d => ViewModel.StartDate = d.Value)"
                                       Variant="Variant.Outlined" />
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudTimePicker Label="Start Time"
                                       Time="@ViewModel.StartTime"
                                       TimeChanged="@(t => ViewModel.StartTime = t.Value)"
                                       Variant="Variant.Outlined" />
                    </MudItem>
                </MudGrid>

                <MudGrid>
                    <MudItem xs="12" sm="6">
                        <MudDatePicker Label="End Date"
                                       DateFormat="dd/MM/yyyy"
                                       Date="@ViewModel.EndDate"
                                       DateChanged="@(d => ViewModel.EndDate = d.Value)"
                                       Variant="Variant.Outlined" />
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudTimePicker Label="End Time"
                                       Time="@ViewModel.EndTime"
                                       TimeChanged="@(t => ViewModel.EndTime = t.Value)"
                                       Variant="Variant.Outlined" />
                    </MudItem>
                </MudGrid>

                @if (Validator.HasError(2))
                {
                    @foreach (var message in Validator.GetErrorMessages(2))
                    {
                        <MudText Color="Color.Error" Typo="Typo.caption">@message</MudText>
                    }
                }
                else
                {
                    <MudText Typo="Typo.caption">
                        Select valid start and end dates for your auction.
                    </MudText>
                }
            </MudStack>
        </MudStep>

        <!-- STEP 4: Confirmation -->
        <MudStep Title="Step 4: Confirmation"
                 SecondaryText="Confirm all details are correct"
                 CompletedChanged="OnCompletedChanged">
            <MudStack Spacing="3">
                <MudText Typo="Typo.subtitle1">
                    @(IsEditMode ? "Confirm your updates" : "Confirm all details are correct")
                </MudText>
                <MudText Typo="Typo.caption" Class="text-secondary">
                    @(IsEditMode
                                        ? "Review your changes before saving."
                                        : "Review your auction information before submission.")
                </MudText>

                <MudDivider Class="my-2" />
            </MudStack>
        </MudStep>
    </MudStepper>
</LoadingContainer>
